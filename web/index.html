<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Pocket Option Signal</title>

  <style>
    :root{
      --bg1:#061a2e;
      --bg2:#03101e;
      --card: rgba(0,0,0,.22);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.66);
      --muted2: rgba(255,255,255,.52);
      --blue1:#46b2ff;
      --blue2:#2b7cff;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 30% -10%, rgba(70,178,255,.35), transparent 55%),
        radial-gradient(900px 500px at 90% 30%, rgba(43,124,255,.25), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      padding: 16px 14px 26px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 12px;
      border-radius: 18px;
      background: rgba(0,0,0,.18);
      border: 1px solid var(--stroke);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width: 0;
    }
    .logo{
      width:36px; height:36px; border-radius: 12px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      font-weight:700;
    }
    .btitles{min-width:0}
    .btitles .name{font-weight:800; font-size:14px; line-height:1.1}
    .btitles .sub{font-size:12px; color:var(--muted2); margin-top:2px}

    .live{
      display:flex; align-items:center; gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.10);
      font-weight:700;
      white-space:nowrap;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background:#2cff7a;
      box-shadow: 0 0 0 3px rgba(44,255,122,.15);
    }
    .live small{font-weight:700; color: var(--muted);}

    .wrap{
      max-width: 520px;
      margin: 14px auto 0;
    }

    .card{
      margin-top: 12px;
      border-radius: 22px;
      background: rgba(0,0,0,.20);
      border:1px solid var(--stroke);
      backdrop-filter: blur(12px);
      padding: 16px;
    }

    .hero{
      border-radius: 18px;
      padding: 18px 16px;
      background: linear-gradient(135deg, rgba(70,178,255,.95), rgba(43,124,255,.85));
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 18px 40px rgba(0,0,0,.25);
    }
    .hero .h1{font-size: 26px; font-weight: 900; letter-spacing:.2px}
    .hero .h2{margin-top:6px; font-size: 14px; color: rgba(255,255,255,.85); font-weight:700}

    .menu{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .btn{
      border-radius: 18px;
      padding: 14px 14px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      cursor:pointer;
      user-select:none;
      transition: transform .06s ease, opacity .2s ease;
      min-height: 74px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .btn:active{transform: translateY(1px); opacity:.95}
    .ico{
      width:36px; height:36px;
      border-radius: 14px;
      display:grid; place-items:center;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      flex: 0 0 auto;
      font-size: 18px;
    }
    .btxt{min-width:0}
    .btxt b{display:block; font-size: 16px; font-weight: 900}
    .btxt span{display:block; font-size: 12.5px; color: var(--muted); margin-top:2px}

    .big{grid-column: 1 / -1;}

    /* VIP: qizil/oltin */
    .vip{
      background:
        linear-gradient(135deg, rgba(255,72,72,.25), rgba(255,196,0,.25)),
        rgba(255,255,255,.06);
      border:1px solid rgba(255,200,0,.35);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .vip .ico{
      background: rgba(255,196,0,.12);
      border:1px solid rgba(255,196,0,.35);
    }

    /* PAGES */
    .page{display:none;}
    .page.active{display:block;}

    .pageBox{
      margin-top: 12px;
      padding: 14px;
      border-radius: 18px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.88);
      line-height: 1.45;
    }

    .back{
      margin-top: 12px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      user-select:none;
      opacity:.95;
    }
    .back:active{transform: translateY(1px); opacity:1}

    .miniTitle{
      font-weight:900;
      font-size:16px;
      margin-bottom: 8px;
    }

    .input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      outline:none;
      font-size: 14px;
    }
    .row{
      display:flex;
      gap:10px;
      margin-top:10px;
    }
    .action{
      flex:1;
      border-radius: 14px;
      padding: 12px 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08);
      cursor:pointer;
      font-weight:800;
      text-align:center;
      user-select:none;
    }
    .action.gold{
      background: linear-gradient(135deg, rgba(255,72,72,.30), rgba(255,196,0,.30));
      border:1px solid rgba(255,200,0,.35);
    }
    .hint{margin-top:8px; color: var(--muted); font-size: 12.5px}

    @media (max-width:360px){
      .menu{grid-template-columns:1fr;}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <div class="logo">PO</div>
      <div class="btitles">
        <div class="name">Pocket Option Signal</div>
        <div class="sub">Mini App ‚Ä¢ Menu</div>
      </div>
    </div>

    <div class="live">
      <span class="dot"></span>
      <span>LIVE</span>
      <small id="onlineCount">‚Äî online</small>
    </div>
  </div>

  <div class="wrap">
    <div class="card">

      <!-- MENU -->
      <div class="page active" id="menu">
        <div class="hero">
          <div class="h1">Pocket Option Signal</div>
          <div class="h2">Bo‚Äòlim tanlang. (3D yo‚Äòq ‚Äî tez va stabil)</div>
        </div>

        <div class="menu">
          <div class="btn" onclick="openPage('signal')">
            <div class="ico">üìà</div>
            <div class="btxt"><b>Pocket Signal</b><span>Signal sahifasi</span></div>
          </div>

          <div class="btn" onclick="openPage('chat')">
            <div class="ico">üí¨</div>
            <div class="btxt"><b>Pocket Chat</b><span>Ilova ichida chat</span></div>
          </div>

          <div class="btn" onclick="openPage('ai')">
            <div class="ico">ü§ñ</div>
            <div class="btxt"><b>AI Analiz</b><span>Keyin ulanadi</span></div>
          </div>

          <div class="btn" onclick="openPage('edu')">
            <div class="ico">üìö</div>
            <div class="btxt"><b>Darslik & Stat</b><span>Grafik / darslar</span></div>
          </div>

          <div class="btn" onclick="openPage('settings')">
            <div class="ico">‚öôÔ∏è</div>
            <div class="btxt"><b>Setting</b><span>Sozlamalar</span></div>
          </div>

          <div class="btn vip" onclick="openVipGate()">
            <div class="ico">üëë</div>
            <div class="btxt"><b>Referal chat ‚Ä¢ VIP</b><span>Faqat ruxsat bilan</span></div>
          </div>

          <div class="btn big" onclick="openPage('help')">
            <div class="ico">üÜò</div>
            <div class="btxt"><b>Help</b><span>Yordam va qo‚Äòllanma</span></div>
          </div>
        </div>
      </div>

      <!-- SIGNAL -->
      <div class="page" id="signal">
        <div class="pageBox">
          <div class="miniTitle">üìà Pocket Signal</div>
          Bu yerga signal UI‚Äôni keyin qo‚Äòshamiz.
          <div class="hint">Hozircha menyu va VIP tekshiruv tizimi ishlaydi.</div>
        </div>
        <div class="back" onclick="openPage('menu')">‚¨ÖÔ∏è Orqaga</div>
      </div>

      <!-- CHAT -->
      <div class="page" id="chat">
        <div class="pageBox">
          <div class="miniTitle">üí¨ Pocket Chat</div>
          Bu yerga chat (API/iframe) keyin ulanadi.
          <div class="hint">Hozircha demo.</div>
        </div>
        <div class="back" onclick="openPage('menu')">‚¨ÖÔ∏è Orqaga</div>
      </div>

      <!-- AI -->
      <div class="page" id="ai">
        <div class="pageBox">
          <div class="miniTitle">ü§ñ AI Analiz</div>
          Keyin ulanadi (indikator/AI tahlil).
          <div class="hint">Hozircha demo.</div>
        </div>
        <div class="back" onclick="openPage('menu')">‚¨ÖÔ∏è Orqaga</div>
      </div>

      <!-- EDU -->
      <div class="page" id="edu">
        <div class="pageBox">
          <div class="miniTitle">üìö Darslik & Stat</div>
          Grafiklar va darsliklar shu yerda bo‚Äòladi.
          <div class="hint">Hozircha demo.</div>
        </div>
        <div class="back" onclick="openPage('menu')">‚¨ÖÔ∏è Orqaga</div>
      </div>

      <!-- SETTINGS -->
      <div class="page" id="settings">
        <div class="pageBox">
          <div class="miniTitle">‚öôÔ∏è Setting</div>
          Dark/light, til, profil ‚Äî keyin qo‚Äòshamiz.
          <div class="hint">Hozircha demo.</div>
        </div>
        <div class="back" onclick="openPage('menu')">‚¨ÖÔ∏è Orqaga</div>
      </div>

      <!-- VIP GATE -->
      <div class="page" id="vip_gate">
        <div class="pageBox">
          <div class="miniTitle">üëë VIP kirish</div>
          VIP bo‚Äòlimga kirish uchun avval Telegram ichida ochilgan bo‚Äòlishi kerak.
          <div class="hint">Agar Telegram ID olinmasa, ‚ÄúTelegram ichida oching‚Äù chiqadi.</div>

          <div class="row">
            <div class="action gold" onclick="tryVip()">VIP tekshirish</div>
            <div class="action" onclick="openPage('menu')">Bekor</div>
          </div>

          <div class="hint" id="vipGateStatus"></div>
        </div>
        <div class="back" onclick="openPage('menu')">‚¨ÖÔ∏è Orqaga</div>
      </div>

      <!-- VIP PAGE -->
      <div class="page" id="vip">
        <div class="pageBox">
          <div class="miniTitle">üëë VIP Menu</div>
          VIP ichidagi menyu:

          <div class="menu" style="margin-top:12px;">
            <div class="btn" onclick="openPage('signal')">
              <div class="ico">üìà</div>
              <div class="btxt"><b>Pocket Signal</b><span>Signal sahifasi</span></div>
            </div>

            <div class="btn" onclick="openPage('ai')">
              <div class="ico">ü§ñ</div>
              <div class="btxt"><b>AI Analiz</b><span>Keyin ulanadi</span></div>
            </div>

            <div class="btn" onclick="openPage('chat')">
              <div class="ico">üí¨</div>
              <div class="btxt"><b>Chat</b><span>Ilova ichida chat</span></div>
            </div>

            <div class="btn" onclick="openPage('info')">
              <div class="ico">‚ÑπÔ∏è</div>
              <div class="btxt"><b>Info</b><span>Qisqa ma‚Äôlumot</span></div>
            </div>
          </div>

          <div class="hint" id="vipStatusText" style="margin-top:10px;"></div>
        </div>
        <div class="back" onclick="openPage('menu')">‚¨ÖÔ∏è Orqaga</div>
      </div>

      <!-- INFO -->
      <div class="page" id="info">
        <div class="pageBox">
          <div class="miniTitle">‚ÑπÔ∏è Info</div>
          Pocket Option Signal miniapp.
          <div class="hint">LIVE, VIP ruxsat, menyular.</div>
        </div>
        <div class="back" onclick="openPage('menu')">‚¨ÖÔ∏è Orqaga</div>
      </div>

      <!-- HELP -->
      <div class="page" id="help">
        <div class="pageBox">
          <div class="miniTitle">üÜò Help</div>
          1) Telegram ichida oching<br/>
          2) Menu orqali bo‚Äòlim tanlang<br/>
          3) VIP uchun admin tasdiqlashi kerak
        </div>
        <div class="back" onclick="openPage('menu')">‚¨ÖÔ∏è Orqaga</div>
      </div>

    </div>
  </div>

  <script>
    // ====== CONFIG ======
    const BACKEND_URL = "https://pocket-miniapp.onrender.com";

    // ====== PAGE SWITCH ======
    function openPage(id){
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const el = document.getElementById(id);
      if(el) el.classList.add('active');
    }

    // ====== TELEGRAM USER ID ======
    function getTelegramId(){
      try{
        if (!window.Telegram || !Telegram.WebApp) return null;
        const u = Telegram.WebApp.initDataUnsafe?.user;
        return u?.id ? String(u.id) : null;
      }catch(e){
        return null;
      }
    }

    // ====== LIVE ONLINE COUNT (SAFE) ======
    async function updateOnline(){
      const el = document.getElementById('onlineCount');
      if(!el) return;

      try{
        // backend turlicha bo‚Äòlishi mumkin, shuning uchun 2 variant
        let r = await fetch(BACKEND_URL + "/api/online", { cache: "no-store" });
        if(!r.ok){
          r = await fetch(BACKEND_URL + "/online", { cache: "no-store" });
        }
        if(!r.ok) throw new Error("no online endpoint");

        const data = await r.json();
        // data: {online: 21} yoki {count:21} yoki {onlineCount:21}
        const n = data.online ?? data.count ?? data.onlineCount;
        if(typeof n === "number" || typeof n === "string"){
          el.textContent = `${n} online`;
        }else{
          el.textContent = `‚Äî online`;
        }
      }catch(e){
        // xato bo‚Äòlsa ham UI buzilmasin
        el.textContent = `‚Äî online`;
      }
    }
    updateOnline();
    setInterval(updateOnline, 8000);

    // ====== VIP GATE ======
    function openVipGate(){
      openPage('vip_gate');
      const s = document.getElementById('vipGateStatus');
      if(s) s.textContent = "";
    }

    async function tryVip(){
      const status = document.getElementById('vipGateStatus');
      const tgId = getTelegramId();

      if(!tgId){
        if(status) status.textContent = "Telegram ID topilmadi. Telegram ichida oching.";
        return;
      }

      if(status) status.textContent = "Tekshirilmoqda...";

      // VIP check endpoint bo‚Äòlmasa ham miniapp yiqilmasin:
      try{
        // Bu endpointni backendda keyin moslab qo‚Äòyamiz.
        // Hozir bo‚Äòlmasa ham "fallback" ishlaydi.
        let r = await fetch(`${BACKEND_URL}/api/vip/check?telegram_id=${encodeURIComponent(tgId)}`, { cache:"no-store" });

        if(!r.ok){
          // Agar backendda bunday endpoint yo‚Äòq bo‚Äòlsa: VIPni ochamiz (default).
          // Shunda UI buzilmaydi va sen bot orqali ruxsatni boshqarasan.
          if(status) status.textContent = "Server VIP tekshiruvini topmadi. VIP ochildi (bot ruxsat bilan).";
          const vipText = document.getElementById('vipStatusText');
          if(vipText) vipText.textContent = `Telegram ID: ${tgId} ‚Ä¢ (Fallback mode)`;
          openPage('vip');
          return;
        }

        const data = await r.json();
        const ok = !!(data.ok ?? data.allowed ?? data.vip ?? data.access);
        if(ok){
          if(status) status.textContent = "VIP ochildi!";
          const vipText = document.getElementById('vipStatusText');
          if(vipText) vipText.textContent = `Telegram ID: ${tgId} ‚Ä¢ VIP: ON`;
          openPage('vip');
        }else{
          if(status) status.textContent = "VIP yopiq. Admin tasdiqlashi kerak.";
        }
      }catch(e){
        // xato bo‚Äòlsa ham miniapp yiqilmasin
        if(status) status.textContent = "Internet/Server xato. VIP ochildi (fallback).";
        const vipText = document.getElementById('vipStatusText');
        if(vipText) vipText.textContent = `Telegram ID: ${tgId} ‚Ä¢ (Fallback mode)`;
        openPage('vip');
      }
    }

    // Telegram WebApp init (ixtiyoriy)
    try{
      if(window.Telegram && Telegram.WebApp){
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
      }
    }catch(e){}
  </script>
</body>
</html>
